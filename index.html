<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Agent – Human Handoff Dashboard</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <style>
        * {
            font-family: 'Inter', sans-serif;
        }

        body {
            background: #f8fafc;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .dashboard-header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(51, 65, 85, 0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            border-color: rgba(30, 144, 255, 0.2);
        }

        .table-container {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(51, 65, 85, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .table-row {
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(51, 65, 85, 0.08);
        }

        .table-row:hover {
            background: rgba(30, 144, 255, 0.03);
        }

        .badge {
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        .badge-student {
            background: rgba(30, 144, 255, 0.15);
            color: #1e90ff;
        }

        .badge-parent {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
        }

        .badge-visitor {
            background: rgba(168, 85, 247, 0.15);
            color: #a855f7;
        }

        .chat-button {
            background: linear-gradient(135deg, #1e90ff 0%, #0ea5e9 100%);
            box-shadow: 0 4px 15px rgba(30, 144, 255, 0.25);
            transition: all 0.3s ease;
        }

        .chat-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(30, 144, 255, 0.35);
        }

        .chat-button:active {
            transform: translateY(0);
        }

        .filter-input {
            background: rgba(255, 255, 255, 0.98);
            border: 2px solid rgba(30, 144, 255, 0.2);
            transition: all 0.2s ease;
        }

        .filter-input:focus {
            border-color: #1e90ff;
            box-shadow: 0 0 0 3px rgba(30, 144, 255, 0.1);
        }

        .scrollbar-custom::-webkit-scrollbar {
            width: 8px;
        }

        .scrollbar-custom::-webkit-scrollbar-track {
            background: transparent;
        }

        .scrollbar-custom::-webkit-scrollbar-thumb {
            background: rgba(30, 144, 255, 0.4);
            border-radius: 10px;
        }

        .scrollbar-custom::-webkit-scrollbar-thumb:hover {
            background: rgba(30, 144, 255, 0.6);
        }

        .table-header {
            background: linear-gradient(135deg, #1e90ff 0%, #0ea5e9 100%);
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-900 font-inter min-h-screen">

    <div id="app" class="min-h-screen p-6 md:p-8">

        <!-- Header -->
        <header class="dashboard-header rounded-2xl px-8 py-6 mb-8 shadow-xl">
            <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-6">
                <div>
                    <h1 class="text-4xl font-bold text-slate-900">Human Agent Dashboard</h1>
                    <p class="text-slate-500 mt-2 font-medium">AI → Human Transfer Monitoring Console</p>
                </div>
                <div class="flex flex-col md:flex-row gap-4 w-full md:w-auto">
                    <select v-model="filterType" class="filter-input rounded-lg px-4 py-3 text-sm font-medium focus:outline-none shadow-sm">
                        <option value="">All Users</option>
                        <option>Student</option>
                        <option>Parent</option>
                        <option>Visitor</option>
                    </select>
                    <input v-model="search" placeholder="Search Chat / Name / Doubt"
                        class="filter-input rounded-lg px-4 py-3 text-sm font-medium focus:outline-none shadow-sm w-full md:w-72" />
                </div>
            </div>
        </header>

        <!-- Stats -->
        <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
            <div class="stat-card rounded-2xl p-6 shadow-lg">
                <p class="text-slate-600 text-sm font-semibold">Total Conversations</p>
                <h2 class="text-4xl font-bold mt-3 text-slate-900">{{ rows.length }}</h2>
            </div>
            <div class="stat-card rounded-2xl p-6 shadow-lg">
                <p class="text-slate-600 text-sm font-semibold">Transferred to Humans</p>
                <h2 class="text-4xl font-bold mt-3 text-orange-600">{{ transferredCount }}</h2>
            </div>
            <div class="stat-card rounded-2xl p-6 shadow-lg">
                <p class="text-slate-600 text-sm font-semibold">Students</p>
                <h2 class="text-4xl font-bold mt-3 text-blue-600">{{ countByType('Student') }}</h2>
            </div>
            <div class="stat-card rounded-2xl p-6 shadow-lg">
                <p class="text-slate-600 text-sm font-semibold">Parents</p>
                <h2 class="text-4xl font-bold mt-3 text-emerald-600">{{ countByType('Parent') }}</h2>
            </div>
        </section>

        <!-- Table -->
        <div class="table-container rounded-2xl overflow-hidden shadow-xl">
            <div class="overflow-x-auto scrollbar-custom">
                <table class="min-w-full text-sm">
                    <thead class="table-header text-white">
                        <tr>
                            <th class="px-6 py-4 text-left font-bold">Chat ID</th>
                            <th class="px-6 py-4 text-left font-bold">Name</th>
                            <th class="px-6 py-4 text-left font-bold">Type</th>
                            <th class="px-6 py-4 text-left font-bold">Intent</th>
                            <th class="px-6 py-4 text-left font-bold">Class / Exam</th>
                            <th class="px-6 py-4 text-left font-bold">Doubt</th>
                            <th class="px-6 py-4 text-left font-bold">Transferred</th>
                            <th class="px-6 py-4 text-left font-bold">Timestamp</th>
                            <th class="px-6 py-4 text-left font-bold">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="row in filteredRows" :key="row['Chat ID']" class="table-row">
                            <td class="px-6 py-4 font-mono text-xs font-semibold text-blue-600">{{ row['Chat ID'] }}</td>
                            <td class="px-6 py-4 font-semibold text-slate-800">{{ row['Name'] }}</td>
                            <td class="px-6 py-4">
                                <span :class="['badge', 'px-4', 'py-2', 'rounded-lg', 'text-xs', 'font-bold', badgeClass(row['Type'])]">{{ row['Type'] }}</span>
                            </td>
                            <td class="px-6 py-4 text-slate-700 text-sm">{{ row['User Intent'] }}</td>
                            <td class="px-6 py-4 text-slate-600 text-sm">{{ row['Class'] }} / {{ row['Target Exam'] }}</td>
                            <td class="px-6 py-4 max-w-xs truncate text-slate-600 text-sm" :title="row['Doubt']">{{ row['Doubt'] }}</td>
                            <td class="px-6 py-4">
                                <span v-if="row['Agent Transferred']==='Yes'"
                                    class="px-3 py-1 rounded-lg text-xs font-bold bg-orange-100 text-orange-700">Yes</span>
                                <span v-else class="px-3 py-1 rounded-lg text-xs font-bold bg-emerald-100 text-emerald-700">No</span>
                            </td>
                            <td class="px-6 py-4 text-xs text-slate-500">{{ row['Time Stamp'] }}</td>
                            <td class="px-6 py-4">
                                <a :href="'chat.html?chatId=' + row['Chat ID'] + '&name=' + encodeURIComponent(row['Name'])"
                                    class="chat-button text-white px-5 py-2 rounded-lg text-sm font-bold inline-block">
                                    Chat
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    search: '',
                    filterType: '',
                    rows: []
                }
            },
            computed: {
                transferredCount() {
                    return this.rows.filter(r => r['Agent Transferred'] === 'Yes').length
                },
                filteredRows() {
                    return this.rows.filter(r => {
                        const matchesType = this.filterType ? r['Type'] === this.filterType : true
                        const q = this.search.toLowerCase()
                        const matchesSearch = !q ||
                            Object.values(r).join(' ').toLowerCase().includes(q)
                        return matchesType && matchesSearch
                    })
                }
            },
            methods: {
                countByType(type) {
                    return this.rows.filter(r => r['Type'] === type).length
                },
                badgeClass(type) {
                    return {
                        'badge-student': type === 'Student',
                        'badge-parent': type === 'Parent',
                        'badge-visitor': type === 'Visitor'
                    }
                },
                parseCSV(text) {
                    const rows = [];
                    let current = '';
                    let insideQuotes = false;
                    
                    for (let i = 0; i < text.length; i++) {
                        const char = text[i];
                        const nextChar = text[i + 1];
                        
                        if (char === '"') {
                            if (insideQuotes && nextChar === '"') {
                                current += '"';
                                i++;
                            } else {
                                insideQuotes = !insideQuotes;
                            }
                            current += char;
                        } else if (char === '\n' && !insideQuotes) {
                            if (current.trim()) rows.push(current);
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    if (current.trim()) rows.push(current);
                    
                    const header = rows[0];
                    const keys = this.parseCSVLine(header);
                    
                    return rows.slice(1).map(line => {
                        const values = this.parseCSVLine(line);
                        let obj = {};
                        keys.forEach((k, i) => obj[k] = values[i] || '');
                        return obj;
                    }).filter(r => r && r['Chat ID']);
                },
                parseCSVLine(line) {
                    const result = [];
                    let current = '';
                    let insideQuotes = false;
                    
                    for (let i = 0; i < line.length; i++) {
                        const char = line[i];
                        const nextChar = line[i + 1];
                        
                        if (char === '"') {
                            if (insideQuotes && nextChar === '"') {
                                current += '"';
                                i++;
                            } else {
                                insideQuotes = !insideQuotes;
                            }
                        } else if (char === ',' && !insideQuotes) {
                            result.push(current.trim());
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    result.push(current.trim());
                    return result;
                },
                async fetchSheet() {
                    const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/1-aRmuDOSu38Oid975ZiAvS3XER-cpO-ldsmfPz46kP8/export?format=csv&gid=0';
                    try {
                        const res = await fetch(SHEET_CSV_URL);
                        const text = await res.text();
                        this.rows = this.parseCSV(text);
                    } catch (e) {
                        console.error('Failed to fetch sheet:', e);
                    }
                }
            },
            mounted() {
                this.fetchSheet();
            }
        }).mount('#app')
    </script>

</body>

</html>